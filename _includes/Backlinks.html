{%- comment -%}
 *
 * MIT License
 * Copyright (c) 2025 Raghuveer S, Hiran Venugopalan, Edoardo Tosin
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 * File: Backlinks.html
 * Author Raghuveer S, Hiran Venugopalan, Edoardo Tosin
 
 * This file contains the markup for the links that refer back to this file.
 * You can find the final thing at the end of every post inside a small greyish box
 *
{%- endcomment -%}

<!-- Add backlinks to the current page --> 
{%- if page.content-type == "post" -%}
  {%- assign content_type = "Post" -%}
{%- else -%}
  {%- assign content_type = "Note" -%}
{%- endif -%}
{%- assign backlink_token = '[' | append: page.title | append: ']' -%}
{%- assign backlinks = "" | split: "" -%}

{%- assign sources = site.notes | concat: site.posts | concat: site.pages -%}

{%- for item in sources -%}
  {%- if item.url != page.url and item.content contains backlink_token -%}
    {%- assign backlinks = backlinks | push: item -%}
  {%- endif -%}
{%- endfor -%}

{%- if backlinks.size > 0 -%}
{%- if site.preferences.backlinks.enabled -%}
  {%- assign display_class = "show" -%}
{%- else -%}
  {%- assign display_class = "hide" -%}
{%- endif -%}

<div class="related {{ display_class }} no-print" id="jekyll-seamless-backlinks" aria-label="Backlinks to this {{ content_type }}">
  <h5 class="meta-title centre-title no-print">Links to this {{ content_type }}</h5>
  <div class="related-wrapper no-print">

    {%- for note in backlinks -%}
      <div class="related-group">
        <a class="no-external-link-icon" href="{{ note.url | absolute_url }}" aria-label="Link to {{ note.title | escape }}">
          <h6>{{ note.title | escape }}</h6>
          <p class="excerpt">
            {{ note.content | strip_html | strip | remove: "[[" | remove: "]]" | remove: "-" | escape | truncate: 100 }}
          </p>
        </a>
      </div>
    {%- endfor -%}

  </div>
</div>
{%- endif -%}
