{%- comment -%}
*
* MIT License
* Copyright (c) 2024 Edoardo Tosin
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* File: Image.html
* Edoardo Tosin
*
* This file contains the markup for a reusable component for displaying images
* within a Lightbox gallery
*
{%- endcomment -%}

{% comment %}
  Single Image Component with PhotoSwipe Integration
  
  Usage:
    {% include Image.html 
      src="/path/to/image.jpg"
      alt="Description"
      caption="Optional caption"
      width="800"
      height="600"
      gallery="my-gallery"
      class="custom-class"
    %}
  
  Parameters:
    - src (required): Image source URL
    - alt (optional): Alt text, defaults to caption or 'Image'
    - caption (optional): Caption text (supports Markdown)
    - width (optional): Image width for aspect ratio
    - height (optional): Image height for aspect ratio
    - gallery (optional): Gallery ID for grouping, defaults to 'default-gallery'
    - class (optional): Additional CSS classes
    - loading (optional): Loading strategy, defaults to 'lazy'
{% endcomment %}

{% assign gallery_id = include.gallery | default: 'default-gallery' %}
{% assign img_loading = include.loading | default: 'lazy' %}
{% assign img_alt = include.alt | default: include.caption | markdownify | strip_html | strip | default: 'Image' %}
{% assign img_caption = include.caption | markdownify | replace: '<p>', '' | replace: '</p>', '' | xml_escape %}

<figure class="image-wrapper" data-pswp-gallery="{{ gallery_id }}">
  <a href="{{ include.src }}"
     class="image-link no-external-link-icon"
     style="outline: none"
     data-pswp-slide
     data-pswp-width="{{ include.width | default: 'auto' }}"
     data-pswp-height="{{ include.height | default: 'auto' }}"
     {% if img_caption != '' %}data-pswp-caption="{{ img_caption }}"{% endif %}
     aria-label="Open image in lightbox{% if include.caption %}: {{ include.caption | strip_html }}{% endif %}">
    
    <div class="image-container{% if include.class %} {{ include.class }}{% endif %}">
      <img src="{{ include.src }}"
           alt="{{ img_alt }}"
           {% if include.width %}width="{{ include.width }}"{% endif %}
           {% if include.height %}height="{{ include.height }}"{% endif %}
           loading="{{ img_loading }}"
           decoding="async"
           class="image-element" />
    </div>
  </a>
  
  {% if include.caption %}
  <figcaption class="image-caption">
    {{ include.caption | markdownify }}
  </figcaption>
  {% endif %}
</figure>
